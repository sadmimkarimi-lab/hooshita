<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨Ø§Ø²ÛŒ Ù‡ÙˆØ´ÛŒØªØ§</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "IRANSans", sans-serif;
    }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #f5f7ff, #eef2ff);
      color: #222;
    }
    .app {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      padding: 16px 20px;
      margin-bottom: 16px;
    }

    /* Ù‡Ø¯Ø± Ø¨Ø§ Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª Ø¯Ù„Ø¨Ø±ØªØ± (Ú©Ù…ÛŒ Ù¾Ø±Ø±Ù†Ú¯â€ŒØªØ±) */
    .header-card {
      background: linear-gradient(135deg, #d4d4ff, #fecdd3);
    }

    /* -------- Ù‡Ø¯Ø± -------- */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .pill-btn {
      border: 1px solid #e5e7eb;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 12px;
      cursor: pointer;
      background: #eef2ff;
      color: #0f172a;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      white-space: nowrap;
    }
    .pill-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
      background: #e0e7ff;
    }

    .logo {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: 3px solid #ffffff;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.18);
      background: #fff;
      overflow: hidden;
      flex-shrink: 0;
    }
    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .header-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-start;
      text-align: right;
    }

    .header-title h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 800;
      color: #1e293b;
    }
    .header-title p {
      margin: 0;
      font-size: 13px;
      color: #6b7280;
    }

    .user-box {
      padding: 6px 10px;
      border-radius: 12px;
      background: #f4f4ff;
      font-size: 12px;
      display: flex;
      gap: 12px;
      color: #4b5563;
    }
    .user-box span {
      font-weight: 600;
      color: #111827;
    }

    /* -------- Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª Ø²ÛŒØ± Ù‡Ø¯Ø± -------- */
    .status-bar {
      display: flex;
      gap: 8px;
      justify-content: space-between;
      margin-bottom: 4px;
      padding: 6px 10px;
      align-items: center;
    }
    .status-pill {
      flex: 1;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 13px;
      background: #f4f4ff;
      color: #4b5563;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: default;
      white-space: nowrap;
    }
    .status-pill.clickable {
      cursor: pointer;
      background: linear-gradient(135deg, #f97316, #facc15);
      color: #111827;
      font-weight: 600;
    }

    /* -------- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ (Û² Ø¯Ø± Û³) -------- */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .game-card {
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }
    .game-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.12);
    }
    .game-card img {
      width: 100%;
      height: 130px;
      object-fit: cover;
    }
    .game-card-body {
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .game-card-title {
      font-size: 14px;
      font-weight: 700;
      color: #111827;
    }
    .game-card-sub {
      font-size: 12px;
      color: #6b7280;
      min-height: 30px;
    }
    .game-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-top: 4px;
      color: #4b5563;
    }
    .game-card-footer button {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      cursor: pointer;
    }

    .game-card.locked {
      filter: grayscale(1);
      opacity: 0.7;
      cursor: default;
    }
    .game-card.locked .lock-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(15, 23, 42, 0.6), transparent);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-size: 13px;
      flex-direction: column;
      gap: 4px;
    }
    .lock-icon {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    /* -------- ØµÙØ­Ù‡â€ŒÛŒ Ø¨Ø§Ø²ÛŒ -------- */
    .hidden {
      display: none !important;
    }

    .game-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .back-btn {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 6px 14px;
      font-size: 12px;
      cursor: pointer;
      color: #374151;
      order: 1;
    }

    .game-title-area {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      order: 0;
    }
    .game-main-title {
      font-size: 18px;
      font-weight: 800;
      margin: 0;
      color: #111827;
    }
    .game-subtitle {
      font-size: 12px;
      color: #6b7280;
      margin: 2px 0 0;
    }

    .game-top-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      align-items: center;
      justify-content: flex-start;
    }
    .stat-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      font-size: 11px;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .stat-pill.heart-pill {
      background: #ffe4e6;
      color: #b91c1c;
    }
    .stat-pill.star-pill {
      background: #fef3c7;
      color: #92400e;
    }
    .stat-pill.timer-pill {
      background: #fee2e2;
      color: #b91c1c;
      font-weight: 600;
    }
    .stat-pill .icon {
      font-size: 22px;
    }

    .bounce {
      animation: bounce 0.45s ease;
    }
    @keyframes bounce {
      0%   { transform: scale(1); }
      35%  { transform: scale(1.35); }
      100% { transform: scale(1); }
    }
    .shake {
      animation: shake 0.45s ease;
    }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    .coach-row {
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .coach-avatar {
      width: 60px;
      height: 60px;
      border-radius: 18px;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 0 6px 18px rgba(79, 70, 229, 0.25);
    }
    .coach-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .coach-bubble {
      flex: 1;
      border-radius: 18px;
      background: linear-gradient(135deg, #eef2ff, #e0f2fe);
      padding: 10px 12px;
      font-size: 13px;
      color: #374151;
    }

    /* Ø±Ø¯ÛŒÙ Ø³ÙˆØ§Ù„ + Ø¢ÙˆØ§ØªØ§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† */
    .qa-row {
      margin-top: 16px;
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }

    .player-avatar {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }
    .player-avatar img {
      width: 150px;
      max-width: 45%;
      height: auto;
      display: block;
    }

    .qa-main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .qa-main .question-block {
      margin-top: 0; /* Ú†ÙˆÙ† Ø¯Ø§Ø®Ù„ Ø±Ø¯ÛŒÙ Ù‡Ø³ØªØŒ Ø¯ÛŒÚ¯Ù‡ ÙØ§ØµÙ„Ù‡ Ø§Ø¶Ø§ÙÛŒ Ù†Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒÙ… */
    }

    @media (max-width: 600px) {
      .qa-row {
        flex-direction: column;
        align-items: center;
      }
      .player-avatar img {
        max-width: 60%;
      }
      .qa-main {
        width: 100%;
      }
    }

    .question-block {
      margin-top: 18px;
      font-size: 15px;
      font-weight: 600;
      color: #111827;
      background: linear-gradient(135deg,#ffffff,#eef2ff);
      padding: 12px 14px;
      border-radius: 18px;
      box-shadow: 0 8px 18px rgba(15,23,42,0.08);
    }

    .options {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .option-btn {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      font-size: 14px;
      background: #f9fafb;
      color: #111827;
      text-align: center;
      cursor: pointer;
      transition: background 0.14s ease, transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.04);
    }
    .option-btn:hover {
      background: #e5e7eb;
      border-color: #c7d2fe;
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
    }
    .option-btn.correct {
      background: #bbf7d0;
      color: #065f46;
      border-color: #4ade80;
    }
    .option-btn.wrong {
      background: #fecaca;
      color: #7f1d1d;
      border-color: #fca5a5;
    }

    .progress-bar-wrap {
      margin-top: 14px;
      height: 14px;
      width: 100%;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: inset 0 0 4px rgba(15,23,42,0.2);
    }
    .progress-bar-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transition: width 0.25s ease;
    }
    .stage-label {
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
      text-align: left;
    }

    /* -------- ÙÙˆØªØ± -------- */
    footer {
      margin-top: 16px;
      padding-bottom: 4px;
    }
    .footer-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      color: #6b7280;
    }
    .footer-row a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
    }
    .footer-row a:hover {
      text-decoration: underline;
    }
    .restart-btn {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 11px;
      background: linear-gradient(135deg, #fb7185, #f97316);
      color: #fff;
      cursor: pointer;
      flex-shrink: 0;
    }

    /* -------- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¹Ù…ÙˆÙ…ÛŒ -------- */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 18px;
      max-width: 320px;
      width: 90%;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.3);
      font-size: 13px;
    }
    .modal h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }
    .modal p {
      margin: 4px 0;
      color: #4b5563;
      line-height: 1.7;
      white-space: pre-line;
    }
    .modal-close {
      margin-top: 10px;
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 8px 0;
      font-size: 13px;
      background: #4f46e5;
      color: #fff;
      cursor: pointer;
    }

    /* -------- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø´Ø±ÙˆØ¹ (Ù†Ø§Ù… + Ú©Ø§Ø±Ø§Ú©ØªØ±) -------- */
    .onboard-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }
    .onboard-backdrop.active {
      display: flex;
    }
    .onboard-modal {
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 20px;
      max-width: 360px;
      width: 92%;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.35);
      font-size: 13px;
      text-align: right;
    }
    .onboard-modal h3 {
      margin: 0 0 8px;
      font-size: 18px;
    }
    .onboard-modal p {
      margin: 4px 0 10px;
      color: #4b5563;
      line-height: 1.7;
    }
    .onboard-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 8px 12px;
      margin-bottom: 12px;
      font-size: 13px;
    }
    .avatar-choices {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .avatar-choice {
      border-radius: 16px;
      border: 2px solid transparent;
      padding: 4px;
      background: #f9fafb;
      cursor: pointer;
      width: 70px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(15,23,42,0.12);
    }
    .avatar-choice img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
      object-fit: cover;
    }
    .avatar-choice.selected {
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79,70,229,0.25);
    }
    .onboard-confirm {
      margin-top: 4px;
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 9px 0;
      font-size: 14px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="app">

  <!-- Ù‡Ø¯Ø± -->
  <div class="card header-card">
    <div class="header">
      <!-- Ø±Ø§Ø³Øª: Ù„ÙˆÚ¯ÙˆØŒ Ø¹Ù†ÙˆØ§Ù†ØŒ Ú©Ø§Ø±Ø¨Ø± -->
      <div class="header-right">
        <div class="logo">
          <img src="https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-07-34-00-477.webp" alt="Ù„ÙˆÚ¯Ùˆ ØªØ§ÙˆÛŒØªØ§">
        </div>
        <div class="header-title-wrap">
          <div class="header-title">
            <h1>Ø¨Ø§Ø²ÛŒ Ù‡ÙˆØ´ÛŒØªØ§</h1>
            <p>Ø°Ù‡Ù†Øª Ø±Ùˆ Ø¨Ù‡ Ú†Ø§Ù„Ø´ Ø¨Ú©Ø´...</p>
          </div>
          <div class="user-box">
            <div>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±: <span id="userName">Ø§Ù„Ù‡Ù‡</span></div>
            <div>Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„: <span id="totalStars">0</span></div>
          </div>
        </div>
      </div>
      <!-- Ú†Ù¾: Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ø¯Ø±Ø¨Ø§Ø±Ù‡ -->
      <div class="header-left">
        <button class="pill-btn" id="helpBtn">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ</button>
        <button class="pill-btn" id="aboutBtn">Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªØ§ÙˆÛŒØªØ§</button>
      </div>
    </div>
  </div>

  <!-- Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª -->
  <div class="card status-bar">
    <div class="status-pill clickable" id="achievementsBtn">
      <span>ğŸ† Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§</span>
    </div>
    <div class="status-pill">
      Ø¨Ø§Ø²ÛŒ ÙØ¹Ù„ÛŒ: <span id="currentGameLabel">-</span>
    </div>
    <div class="status-pill">
      Ù…Ø±Ø­Ù„Ù‡: <span id="currentStageLabel">-</span>
    </div>
  </div>

  <!-- ÙÙ‡Ø±Ø³Øª Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ -->
  <div class="card" id="gamesScreen">
    <div class="games-grid" id="gamesGrid"></div>
  </div>

  <!-- ØµÙØ­Ù‡â€ŒÛŒ Ø¨Ø§Ø²ÛŒ -->
  <div class="card hidden" id="gameScreen">
    <div class="game-header-row">
      <div class="game-title-area">
        <h2 class="game-main-title" id="gameTitle"></h2>
        <p class="game-subtitle" id="gameSubtitle"></p>
      </div>
      <button class="back-btn" id="backToListBtn">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙÙ‡Ø±Ø³Øª</button>
    </div>

    <div class="game-top-stats">
      <div class="stat-pill star-pill" id="starStat">
        <span class="icon">â­</span>
        <span>Ø§Ù…ØªÛŒØ§Ø²:</span>
        <span id="gameStars">0</span>
      </div>
      <div class="stat-pill heart-pill" id="heartStat">
        <span class="icon">â¤ï¸</span>
        <span>Ø¬Ø§Ù†:</span>
        <span id="heartsCount">3</span>
      </div>
      <div class="stat-pill timer-pill">
        â± Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡:
        <span id="timerValue">-- Ø«Ø§Ù†ÛŒÙ‡</span>
      </div>
    </div>

    <div class="coach-row">
      <div class="coach-avatar">
        <img id="coachImg" src="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-13-10-261.png" alt="ØªØ§ÙˆÛŒØªØ§">
      </div>
      <div class="coach-bubble" id="coachText">
        Ø¢Ø±ÙˆÙ… Ø¨Ø§Ø´ØŒ Ø¨Ø§ Ø¯Ù‚Øª Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡. Ø¨Ø¨ÛŒÙ†ÛŒÙ… Ú†Ù‚Ø¯Ø± Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¬Ù„Ùˆ Ø¨Ø±ÛŒ.
      </div>
    </div>

    <!-- Ø±Ø¯ÛŒÙ Ø¢ÙˆØ§ØªØ§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† + Ø³ÙˆØ§Ù„ Ùˆ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ -->
    <div class="qa-row">
      <div class="player-avatar">
        <img id="playerAvatar" src="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-36-511.png" alt="Ø¢ÙˆØ§ØªØ§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù†">
      </div>
      <div class="qa-main">
        <div class="question-block" id="questionText"></div>
        <div class="options" id="optionsContainer"></div>
      </div>
    </div>

    <div class="progress-bar-wrap">
      <div class="progress-bar-inner" id="progressInner"></div>
    </div>
    <div class="stage-label" id="stageLabelBottom"></div>
  </div>

  <!-- ÙÙˆØªØ± -->
  <footer>
    <div class="footer-row">
      <button class="restart-btn" id="restartBtn">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§Ø²ÛŒ</button>
      <div>
        Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÙˆØ³Ø· ØªØ§ÙˆÛŒØªØ§ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡.
        <a href="https://eitaa.com/tavita" target="_blank">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ØªØ§ÙˆÛŒØªØ§</a>
      </div>
    </div>
  </footer>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§ -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal" id="modalBox">
    <h3 id="modalTitle">Ø¹Ù†ÙˆØ§Ù†</h3>
    <p id="modalBody">Ù…ØªÙ† Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§ÛŒÙ†Ø¬Ø§Ø³Øª.</p>
    <button class="modal-close" id="modalCloseBtn">Ø¨Ø§Ø´Ù‡</button>
  </div>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø´Ø±ÙˆØ¹ (Ù†Ø§Ù… + Ú©Ø§Ø±Ø§Ú©ØªØ±) -->
<div class="onboard-backdrop" id="onboardBackdrop">
  <div class="onboard-modal">
    <h3>Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ù‡ÙˆØ´ÛŒØªØ§ ğŸ®</h3>
    <p>Ø§ÙˆÙ„ Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ Ùˆ ÛŒÚ©ÛŒ Ø§Ø² Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØªØ§ÙˆÛŒØªØ§ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†. Ù‡Ø± ÙˆÙ‚Øª Ø¨Ø±Ú¯Ø´ØªÛŒØŒ Ø§Ø² Ù‡Ù…ÛŒÙ†â€ŒØ¬Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯ÛŒ.</p>
    <input id="onboardNameInput" class="onboard-input" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø§Ù„Ù‡Ù‡">

    <div class="avatar-choices">
      <button type="button" class="avatar-choice selected"
              data-avatar="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-36-511.png">
        <img src="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-36-511.png" alt="Ú©Ø§Ø±Ø§Ú©ØªØ± Û±">
      </button>

      <button type="button" class="avatar-choice"
              data-avatar="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-14-607.png">
        <img src="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-14-607.png" alt="Ú©Ø§Ø±Ø§Ú©ØªØ± Û²">
      </button>

      <button type="button" class="avatar-choice"
              data-avatar="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-55-52-957.png">
        <img src="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-55-52-957.png" alt="Ú©Ø§Ø±Ø§Ú©ØªØ± Û³">
      </button>

      <button type="button" class="avatar-choice"
              data-avatar="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-12-45-646.png">
        <img src="https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-12-45-646.png" alt="Ú©Ø§Ø±Ø§Ú©ØªØ± Û´">
      </button>
    </div>

    <button id="onboardConfirmBtn" class="onboard-confirm">Ø¨Ø²Ù† Ø¨Ø±ÛŒÙ… ğŸ˜</button>
  </div>
</div>

<script>
  // -------- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ --------
  const gamesData = [
    {
      id: 1,
      title: "Ø¨Ø§Ø²ÛŒ Û± - Ø³Ø±Ø¹Øª Ø°Ù‡Ù†",
      subtitle: "Ù‚Ø¨Ù„ Ø§Ø² ØªÙ…Ø§Ù… Ø´Ø¯Ù† Ø²Ù…Ø§Ù†ØŒ Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.",
      teaser: "Ø³Ø±ÛŒØ¹â€ŒØªØ± Ø§Ø² Ø²Ù…Ø§Ù† Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ Ùˆ Ø¨Ø¨ÛŒÙ† ÙˆØ§Ù‚Ø¹Ø§Ù‹ Ú†Ù‚Ø¯Ø± ØªÛŒØ²Ù‡ÙˆØ´ÛŒ!",
      img: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-59-27-132.png",
      coachImg: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-13-10-261.png",
      timePerStageSec: 8,
      stages: [
        { q: "Ú©Ø¯ÙˆÙ… Ø¹Ø¯Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ±Ù‡ØŸ", options: ["Ûµ", "Û·"], correct: 1 },
        { q: "Ù†ØªÛŒØ¬Ù‡ Û³ + Û´ Ú†Ù†Ø¯Ù‡ØŸ", options: ["Û¶", "Û·"], correct: 1 },
        { q: "Ú©Ø¯ÙˆÙ… Ø¹Ø¯Ø¯ Ú©ÙˆÚ†Ú©â€ŒØªØ±Ù‡ØŸ", options: ["Û¹", "Û²"], correct: 1 },
        { q: "Ù†ØªÛŒØ¬Ù‡ Û±Û° - Û³ Ú†Ù†Ø¯Ù‡ØŸ", options: ["Û·", "Û¶"], correct: 0 },
        { q: "Ø¨Ø¹Ø¯ Ø§Ø² Ø¹Ø¯Ø¯ Û¸ØŒ Ú©Ø¯ÙˆÙ…Ù‡ØŸ", options: ["Û¹", "Û·"], correct: 0 },
        { q: "Ú©Ø¯ÙˆÙ… Ø¹Ø¯Ø¯ Ø²ÙˆØ¬ Ø§Ø³ØªØŸ", options: ["Ûµ", "Û¸"], correct: 1 },
        { q: "Ù†ØªÛŒØ¬Ù‡ Û² Ã— Û³ Ú†Ù†Ø¯Ù‡ØŸ", options: ["Ûµ", "Û¶"], correct: 1 },
        { q: "Ú©Ø¯ÙˆÙ… Ø¨Ø²Ø±Ú¯â€ŒØªØ±Ù‡ØŸ", options: ["Û±Û²", "Û¹"], correct: 0 },
        { q: "Ø¹Ø¯Ø¯ Ù…ÛŒØ§Ù†ÛŒ Ø¨ÛŒÙ† Û³ Ùˆ Ûµ Ú†Ù†Ø¯Ù‡ØŸ", options: ["Û´", "Û¶"], correct: 0 },
        { q: "Ù†ØªÛŒØ¬Ù‡ Û¹ - Û´ Ú†Ù†Ø¯Ù‡ØŸ", options: ["Ûµ", "Û³"], correct: 0 }
      ]
    },
    {
      id: 2,
      title: "Ø¨Ø§Ø²ÛŒ Û² - Ø­Ø§ÙØ¸Ù‡ ØªØ§ÙˆÛŒØªØ§",
      subtitle: "Ø§Ù„Ú¯ÙˆØŒ ØªØµÙˆÛŒØ± ÛŒØ§ Ø¹Ø¯Ø¯ Ø±Ùˆ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø¨Ø³Ù¾Ø§Ø± Ùˆ Ø¯Ø±Ø³Øª ØªÚ©Ø±Ø§Ø± Ú©Ù†.",
      teaser: "Ø§Ù„Ú¯ÙˆÙ‡Ø§ Ø®ÛŒÙ„ÛŒ Ø²ÙˆØ¯ ÙØ±Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø› ÛŒØ§Ø¯Øª Ø¨Ù…ÙˆÙ†Ù‡!",
      img: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-55-52-957.png",
      coachImg: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-06-01-08-979.png",
      timePerStageSec: 10,
      stages: [
        { q: "Ú©Ø¯ÙˆÙ… Ø¯Ù†Ø¨Ø§Ù„Ù‡ Ø¨Ø§ Û±ØŒÛ²ØŒÛ³ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ", options: ["Û±-Û²-Û³-Û´", "Û³-Û²-Û±-Û°"], correct: 0 },
        { q: "Ú©Ø¯ÙˆÙ… Ø¯Ùˆ Ø¹Ø¯Ø¯ Ù¾Ø´Øª Ù‡Ù… Ù‡Ø³ØªÙ†Ø¯ØŸ", options: ["Û´ Ùˆ Û¶", "Û¶ Ùˆ Û·"], correct: 1 }
      ]
    },
    {
      id: 3,
      title: "Ø¨Ø§Ø²ÛŒ Û³ - ØªÙ…Ø±Ú©Ø²",
      subtitle: "Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
      teaser: "Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ ÛŒÚ© Ú†Ø§Ù„Ø´ ØªÙ…Ø±Ú©Ø² Ø¬Ø¯ÛŒ Ø§ÛŒÙ†Ø¬Ø§Ø³Øª.",
      img: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-14-607.png",
      locked: true
    },
    {
      id: 4,
      title: "Ø¨Ø§Ø²ÛŒ Û´ - Ú©Ù„Ù…Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯",
      subtitle: "Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
      teaser: "Ø¨Ø§ Ú©Ù„Ù…Ø§Øª Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ùˆ Ù…ØºØ²Øª Ø±Ùˆ Ù‚Ù„Ù‚Ù„Ú© Ù…ÛŒâ€ŒØ¯ÛŒÙ….",
      img: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-56-36-511.png",
      locked: true
    },
    {
      id: 5,
      title: "Ø¨Ø§Ø²ÛŒ Ûµ - ÙˆØ§Ú©Ù†Ø´ Ø³Ø±ÛŒØ¹",
      subtitle: "Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
      teaser: "Ø³Ø±Ø¹Øª ÙˆØ§Ú©Ù†Ø´â€ŒØ§Øª Ø±Ùˆ Ù…ÛŒâ€ŒØ³Ù†Ø¬ÛŒÙ….",
      img: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-58-46-211.png",
      locked: true
    },
    {
      id: 6,
      title: "Ø¨Ø§Ø²ÛŒ Û¶ - Ú†Ø§Ù„Ø´ Ù†Ù‡Ø§ÛŒÛŒ",
      subtitle: "Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
      teaser: "Ø¢Ø®Ø±ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ØŒ Ù…Ø®ØµÙˆØµ Ù‚Ù‡Ø±Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ ØªØ§ÙˆÛŒØªØ§!",
      img: "https://cdnfa.com/irangiah/a9be/uploads/new6/picsart-25-11-16-05-12-45-646.png",
      locked: true
    }
  ];

  // -------- ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒ --------
  const state = {
    userName: "Ø§Ù„Ù‡Ù‡",
    totalStars: 0,
    unlockedGames: new Set([1]),
    currentGameId: null,
    currentStage: 0,
    hearts: 3,
    gameStars: 0
  };

  const USER_KEY = "hoshitaUserName";
  const AVATAR_KEY = "hoshitaAvatarUrl";

  // Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§
  const gamesGrid = document.getElementById("gamesGrid");
  const gamesScreen = document.getElementById("gamesScreen");
  const gameScreen = document.getElementById("gameScreen");

  const userNameEl = document.getElementById("userName");
  const totalStarsEl = document.getElementById("totalStars");
  const currentGameLabel = document.getElementById("currentGameLabel");
  const currentStageLabel = document.getElementById("currentStageLabel");

  const gameTitleEl = document.getElementById("gameTitle");
  const gameSubtitleEl = document.getElementById("gameSubtitle");
  const coachImgEl = document.getElementById("coachImg");
  const coachTextEl = document.getElementById("coachText");

  const playerAvatarEl = document.getElementById("playerAvatar");

  const heartsCountEl = document.getElementById("heartsCount");
  const gameStarsEl = document.getElementById("gameStars");
  const starStatEl = document.getElementById("starStat");
  const heartStatEl = document.getElementById("heartStat");

  const questionTextEl = document.getElementById("questionText");
  const optionsContainer = document.getElementById("optionsContainer");
  const progressInner = document.getElementById("progressInner");
  const stageLabelBottom = document.getElementById("stageLabelBottom");
  const timerValueEl = document.getElementById("timerValue");

  const backToListBtn = document.getElementById("backToListBtn");
  const restartBtn = document.getElementById("restartBtn");

  const achievementsBtn = document.getElementById("achievementsBtn");
  const helpBtn = document.getElementById("helpBtn");
  const aboutBtn = document.getElementById("aboutBtn");

  const modalBackdrop = document.getElementById("modalBackdrop");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");
  const modalCloseBtn = document.getElementById("modalCloseBtn");

  // Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø´Ø±ÙˆØ¹
  const onboardBackdrop = document.getElementById("onboardBackdrop");
  const onboardNameInput = document.getElementById("onboardNameInput");
  const onboardConfirmBtn = document.getElementById("onboardConfirmBtn");
  const avatarButtons = document.querySelectorAll(".avatar-choice");
  let selectedAvatarUrl = avatarButtons[0]?.dataset.avatar || "";

  // ØªØ§ÛŒÙ…Ø±
  let timerInterval = null;
  let timerRemaining = 0;

  // ---- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¯Ø± Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø´Ø±ÙˆØ¹ ----
  avatarButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      avatarButtons.forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      selectedAvatarUrl = btn.dataset.avatar;
    });
  });

  function showOnboarding() {
    onboardNameInput.value = state.userName || "";
    onboardBackdrop.classList.add("active");
  }
  function hideOnboarding() {
    onboardBackdrop.classList.remove("active");
  }

  onboardConfirmBtn.addEventListener("click", () => {
    const name = onboardNameInput.value.trim() || "Ø¯ÙˆØ³Øª ØªØ§ÙˆÛŒØªØ§";
    state.userName = name;
    userNameEl.textContent = name;
    try {
      localStorage.setItem(USER_KEY, name);
      if (selectedAvatarUrl) {
        localStorage.setItem(AVATAR_KEY, selectedAvatarUrl);
      }
    } catch (e) {}
    if (selectedAvatarUrl) {
      playerAvatarEl.src = selectedAvatarUrl;
    }
    hideOnboarding();
    renderGamesList();
  });

  function initUser() {
    try {
      const savedName = localStorage.getItem(USER_KEY);
      const savedAvatar = localStorage.getItem(AVATAR_KEY);
      if (savedName) {
        state.userName = savedName;
        userNameEl.textContent = savedName;
      }
      if (savedAvatar) {
        selectedAvatarUrl = savedAvatar;
        playerAvatarEl.src = savedAvatar;
      } else {
        selectedAvatarUrl = avatarButtons[0]?.dataset.avatar || selectedAvatarUrl;
        playerAvatarEl.src = selectedAvatarUrl;
      }
      if (!savedName) {
        showOnboarding();
      }
    } catch (e) {
      showOnboarding();
    }
  }

  // ---- Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ ----
  function renderGamesList() {
    userNameEl.textContent = state.userName;
    totalStarsEl.textContent = state.totalStars;

    gamesGrid.innerHTML = "";
    gamesData.forEach(game => {
      const card = document.createElement("div");
      const isUnlocked = state.unlockedGames.has(game.id) && !game.locked;

      card.className = "game-card" + (isUnlocked ? "" : " locked");
      card.innerHTML = `
        <img src="${game.img}" alt="${game.title}">
        <div class="game-card-body">
          <div class="game-card-title">${game.title}</div>
          <div class="game-card-sub">${game.teaser}</div>
          <div class="game-card-footer">
            <span>Ù…Ø±Ø§Ø­Ù„: <strong>${game.stages ? game.stages.length : "?"}</strong></span>
            ${isUnlocked ? `<button type="button">Ú†Ø§Ù„Ø´ Ø°Ù‡Ù†</button>` : ""}
          </div>
          ${isUnlocked ? "" : `
          <div class="lock-overlay">
            <div class="lock-icon">ğŸ”’</div>
            <div>Ø§ÙˆÙ„ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ùˆ ØªÙ…Ø§Ù… Ú©Ù†</div>
          </div>`}
        </div>
      `;
      if (isUnlocked) {
        card.addEventListener("click", () => startGame(game.id));
      }
      gamesGrid.appendChild(card);
    });
  }

  // ---- Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ ----
  function startGame(gameId) {
    const game = gamesData.find(g => g.id === gameId);
    if (!game) return;

    clearInterval(timerInterval);

    state.currentGameId = gameId;
    state.currentStage = 0;
    state.hearts = 3;
    state.gameStars = 0;

    gameTitleEl.textContent = game.title;
    gameSubtitleEl.textContent = game.subtitle;
    coachImgEl.src = game.coachImg;
    coachTextEl.textContent = "Ø¢Ø±ÙˆÙ… Ø¨Ø§Ø´ØŒ Ø¨Ø§ Ø¯Ù‚Øª Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡. Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ Ú©Ù‡ Ø¬Ù„Ùˆ Ø¨Ø±ÛŒØŒ Ø³ØªØ§Ø±Ù‡ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ!";

    gamesScreen.classList.add("hidden");
    gameScreen.classList.remove("hidden");

    updateGameUi();
  }

  // ---- ØªØ§ÛŒÙ…Ø± Ù…Ø±Ø­Ù„Ù‡ ----
  function startTimerForStage(game) {
    clearInterval(timerInterval);
    const baseSec = game.timePerStageSec || 10;
    timerRemaining = baseSec;
    updateTimerLabel();
    timerInterval = setInterval(() => {
      timerRemaining--;
      if (timerRemaining <= 0) {
        clearInterval(timerInterval);
        handleTimeout();
      } else {
        updateTimerLabel();
      }
    }, 1000);
  }

  function updateTimerLabel() {
    timerValueEl.textContent = `${timerRemaining} Ø«Ø§Ù†ÛŒÙ‡ â³`;
  }

  // ---- Ø¢Ù¾Ø¯ÛŒØª UI Ø¨Ø§Ø²ÛŒ ----
  function updateGameUi() {
    const game = gamesData.find(g => g.id === state.currentGameId);
    if (!game) return;

    const stageCount = game.stages.length;
    const currentStageIndex = Math.max(0, Math.min(state.currentStage, stageCount - 1));
    const stageData = game.stages[currentStageIndex];

    currentGameLabel.textContent = game.title;
    currentStageLabel.textContent = `${currentStageIndex + 1} Ø§Ø² ${stageCount}`;

    heartsCountEl.textContent = state.hearts.toString();
    gameStarsEl.textContent = state.gameStars.toString();

    stageLabelBottom.textContent = `Ù…Ø±Ø­Ù„Ù‡ ${currentStageIndex + 1} Ø§Ø² ${stageCount}`;

    const progress = (currentStageIndex / stageCount) * 100;
    progressInner.style.width = `${progress}%`;

    questionTextEl.textContent = stageData.q;
    optionsContainer.innerHTML = "";
    stageData.options.forEach((opt, index) => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.textContent = opt;
      btn.addEventListener("click", () => handleAnswer(index));
      optionsContainer.appendChild(btn);
    });

    startTimerForStage(game);
  }

  // ---- Ù¾Ø§Ø³Ø® Ú©Ø§Ø±Ø¨Ø± ----
  let answeringLocked = false;

  function handleAnswer(index) {
    if (answeringLocked) return;
    const game = gamesData.find(g => g.id === state.currentGameId);
    if (!game) return;

    clearInterval(timerInterval);
    const stageData = game.stages[state.currentStage];
    const correctIndex = stageData.correct;

    const optionButtons = Array.from(document.querySelectorAll(".option-btn"));
    answeringLocked = true;

    optionButtons.forEach((btn, idx) => {
      if (idx === correctIndex) btn.classList.add("correct");
      if (idx === index && index !== correctIndex) btn.classList.add("wrong");
    });

    if (index === correctIndex) {
      state.gameStars += 1;
      state.totalStars += 1;
      pulse(starStatEl, "bounce");
      coachTextEl.textContent = "Ø¢ÙØ±ÛŒÙ†! ÛŒÙ‡ Ù‚Ø¯Ù… Ø¯ÛŒÚ¯Ù‡ Ø¬Ù„Ùˆ Ø±ÙØªÛŒ. Ø¨Ø±Ùˆ Ø¨Ø¹Ø¯ÛŒ ğŸ‘";
      setTimeout(() => {
        state.currentStage++;
        if (state.currentStage >= game.stages.length) {
          unlockNextGame();
          showModal("Ø¢ÙØ±ÛŒÙ† Ù‚Ù‡Ø±Ù…Ø§Ù†! ğŸ‰",
            "ØªÙ…Ø§Ù… Ù…Ø±Ø§Ø­Ù„ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ø±Ùˆ Ø±Ø¯ Ú©Ø±Ø¯ÛŒ.\nÙ…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø±Ùˆ Ù‡Ù… Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒ.");
          backToList();
        } else {
          updateGameUi();
        }
        updateGlobalStats();
        answeringLocked = false;
      }, 700);
    } else {
      state.hearts -= 1;
      pulse(heartStatEl, "shake");
      coachTextEl.textContent = "Ø§Ø´Ú©Ø§Ù„ÛŒ Ù†Ø¯Ø§Ø±Ù‡ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†. Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ù†Ú¯Ø§Ù‡ Ú©Ù†.";

      setTimeout(() => {
        if (state.hearts <= 0) {
          showModal("Ø¬Ø§Ù†â€ŒÙ‡Ø§Øª ØªÙ…ÙˆÙ… Ø´Ø¯ ğŸ˜…",
            "Ù†Ú¯Ø±Ø§Ù† Ù†Ø¨Ø§Ø´Ø› Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§Ø²ÛŒÂ» Ú©Ù„ Ø¨Ø§Ø²ÛŒ Ø±Ùˆ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒ.");
          resetCurrentGameOnly();
        } else {
          updateGameUi();
        }
        updateGlobalStats();
        answeringLocked = false;
      }, 700);
    }
  }

  function handleTimeout() {
    if (answeringLocked) return;
    answeringLocked = true;
    state.hearts -= 1;
    pulse(heartStatEl, "shake");
    coachTextEl.textContent = "ÙˆÙ‚ØªØª ØªÙ…ÙˆÙ… Ø´Ø¯! Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ø³Ø±ÛŒØ¹â€ŒØªØ± Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡.";

    setTimeout(() => {
      if (state.hearts <= 0) {
        showModal("Ø²Ù…Ø§Ù†Øª ØªÙ…ÙˆÙ… Ø´Ø¯ ğŸ˜…",
          "Ù‡Ù…Ù‡â€ŒÛŒ Ø¬Ø§Ù†â€ŒÙ‡Ø§Øª Ø±ÙØª. Ø¨Ø§ Â«Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§Ø²ÛŒÂ» Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú©Ù„ Ø¨Ø§Ø²ÛŒ Ø±Ùˆ Ø§Ø² ØµÙØ± Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒ.");
        resetCurrentGameOnly();
      } else {
        updateGameUi();
      }
      updateGlobalStats();
      answeringLocked = false;
    }, 700);
  }

  function pulse(el, className) {
    el.classList.remove(className);
    void el.offsetWidth;
    el.classList.add(className);
    setTimeout(() => el.classList.remove(className), 450);
  }

  function resetCurrentGameOnly() {
    const game = gamesData.find(g => g.id === state.currentGameId);
    if (!game) return;
    clearInterval(timerInterval);
    state.hearts = 3;
    state.gameStars = 0;
    state.currentStage = 0;
    updateGameUi();
  }

  function unlockNextGame() {
    const currentIndex = gamesData.findIndex(g => g.id === state.currentGameId);
    if (currentIndex >= 0 && currentIndex < gamesData.length - 1) {
      const nextGame = gamesData[currentIndex + 1];
      if (nextGame) {
        nextGame.locked = false;
        state.unlockedGames.add(nextGame.id);
      }
      renderGamesList();
    }
  }

  function updateGlobalStats() {
    totalStarsEl.textContent = state.totalStars.toString();
    gameStarsEl.textContent = state.gameStars.toString();
    heartsCountEl.textContent = state.hearts.toString();
  }

  // ---- Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒ ----
  function resetAllGameProgress() {
    clearInterval(timerInterval);
    state.totalStars = 0;
    state.unlockedGames = new Set([1]);
    state.currentGameId = null;
    state.currentStage = 0;
    state.hearts = 3;
    state.gameStars = 0;

    gamesData.forEach((g, index) => {
      if (index === 0) {
        g.locked = false;
      } else {
        g.locked = true;
      }
    });

    updateGlobalStats();
    backToList();
  }

  // ---- Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ ÙÙ‡Ø±Ø³Øª ----
  function backToList() {
    clearInterval(timerInterval);
    state.currentGameId = null;
    gameScreen.classList.add("hidden");
    gamesScreen.classList.remove("hidden");
    currentGameLabel.textContent = "-";
    currentStageLabel.textContent = "-";
    renderGamesList();
  }
  backToListBtn.addEventListener("click", backToList);

  // ---- Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø§Ø² ÙÙˆØªØ± (Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„) ----
  restartBtn.addEventListener("click", resetAllGameProgress);

  // ---- Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§ ----
  function showModal(title, body) {
    modalTitle.textContent = title;
    modalBody.textContent = body;
    modalBackdrop.classList.add("active");
  }
  function hideModal() {
    modalBackdrop.classList.remove("active");
  }
  modalCloseBtn.addEventListener("click", hideModal);
  modalBackdrop.addEventListener("click", (e) => {
    if (e.target === modalBackdrop) hideModal();
  });

  // Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ø¨Ù‡ Ø´Ú©Ù„ Ø¢ÛŒØªÙ…ÛŒ Ùˆ Ø¬Ø°Ø§Ø¨
  achievementsBtn.addEventListener("click", () => {
    const unlockedCount = state.unlockedGames.size;
    const currentGame = gamesData.find(g => g.id === state.currentGameId);
    const currentGameTitle = currentGame ? currentGame.title : "â€”";
    const currentStageHuman = currentGame ? state.currentStage + 1 : "â€”";

    const body =
      `Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†: ${state.userName}\n` +
      `Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„: ${state.totalStars}\n` +
      `Ø¨Ø§Ø²ÛŒ ÙØ¹Ù„ÛŒ: ${currentGameTitle}\n` +
      `Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ù„ÛŒ: ${currentStageHuman}\n` +
      `Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø² Ø´Ø¯Ù‡: ${unlockedCount} Ø§Ø² Û¶\n\n` +
      `ğŸ”¥ Ù‡Ø± Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª = ÛŒÚ© Ø³ØªØ§Ø±Ù‡.\n` +
      `ğŸ¯ Ø³Ø¹ÛŒ Ú©Ù† Ø±Ú©ÙˆØ±Ø¯ Ø§Ù…ØªÛŒØ§Ø²Øª Ø±Ùˆ Ù‡Ø± Ø¨Ø§Ø± Ø¨Ù‡ØªØ± Ú©Ù†ÛŒ!`;

    showModal("Ø®Ù„Ø§ØµÙ‡Ù” Ù¾ÛŒØ´Ø±ÙØªØª ØªØ§ Ø§Ù„Ø§Ù†", body);
  });

  helpBtn.addEventListener("click", () => {
    showModal(
      "Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ",
      "Û±) Ø§Ø² ÙÙ‡Ø±Ø³ØªØŒ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.\n" +
      "Û²) Ø¯Ø± Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ØŒ Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.\n" +
      "Û³) Ù‡Ø± Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª = ÛŒÚ© Ø³ØªØ§Ø±Ù‡.\n" +
      "Û´) Ø¨Ø§ Ø³Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ ÛŒØ§ Ø§ØªÙ…Ø§Ù… Ø²Ù…Ø§Ù†ØŒ Ø¬Ø§Ù†â€ŒÙ‡Ø§ ØªÙ…ÙˆÙ… Ù…ÛŒâ€ŒØ´Ù† Ùˆ Ø¨Ø§Ø²ÛŒ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´Ù‡.\n" +
      "Ûµ) Ø¨Ø§ ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ù† Ù‡Ø± Ø¨Ø§Ø²ÛŒØŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´Ù‡.\n" +
      "Û¶) Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒ Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ø±Ùˆ Ø§Ø² ØµÙØ± Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØŒ Ø§Ø² Ø¯Ú©Ù…Ù‡ Â«Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§Ø²ÛŒÂ» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†."
    );
  });

  aboutBtn.addEventListener("click", () => {
    showModal(
      "Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªØ§ÙˆÛŒØªØ§",
      "Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ÛŒØªØ§ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±ÛŒÙ† Ù…ØºØ²ØŒ ØªÙ…Ø±Ú©Ø²ØŒ Ø³Ø±Ø¹Øª Ø°Ù‡Ù† Ùˆ Ø­Ø§ÙØ¸Ù‡ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡.\n" +
      "Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÙˆØ³Ø· ØªÛŒÙ… ØªØ§ÙˆÛŒØªØ§ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªØ§ ØªÙ…Ø±ÛŒÙ†ØŒ Ø´Ø¨ÛŒÙ‡ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ù‚Ø´Ù†Ú¯ Ùˆ Ø¯ÙˆØ³Øªâ€ŒØ¯Ø§Ø´ØªÙ†ÛŒ Ø¨Ø§Ø´Ù‡."
    );
  });

  // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡
  initUser();
  if (!onboardBackdrop.classList.contains("active")) {
    renderGamesList();
  }
</script>
</body>
</html>
